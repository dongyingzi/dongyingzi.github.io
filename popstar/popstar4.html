<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>popStar</title>
	<style>
	.c1,.c2,.c3,.c4,.c5{ width:40px; height: 40px; background: red; border:1px solid #000; display: block;}
	.c2{ background: yellow;}
	.c3{ background: green;}
	.c4{ background: blue;}
	.c5{ background: purple;}
	#pop .hover{ border:1px solid #fff}
	#pop div {float: left;}
	#pop2 div {float: left;}
	#pop,#pop2,#pop3{  overflow: hidden; float: left; margin-right:20px}

	</style>
</head>
<body>
	<div id="mess"></div>
	<div id="pop"></div>
	<div id="pop2"></div>
	<div id="pop3"></div>
	<script>

	var popStar ={
		arr1:new Array(),//原始数组
		arr2:new Array(),//查找出的数组
		arr3:new Array(),//存放arr1数组没列的长度
		arrVlineNum:10,//数组的行数
		arrLineNum:10,//数组的列数
		arrTotalNum:5,//数组中总共存在的值
		spanNum:new Array(),
		init:function(){
			this.fillArr(popStar.arr1,this.arrTotalNum);
			this.draw(this.arr1,"pop");
			this.bindEventClick();
		},
		fillArr:function(arr,n){//填充数组
			for (var i = 0; i < this.arrLineNum; i++) {
				arr[i]= new Array();
				for (var j = 0; j < this.arrVlineNum; j++) {
						arr[i][j]=parseInt(n*Math.random()+1);
				};	
			}	
		},
		draw:function(arr,div){//绘制界面
			var inString = "";
			for (var i = 0; i < arr.length; i++) {
				if(arr[i].length==0){//列数为空时
				 arr.splice(i,1);
				}
			};
			for (var i = 0; i < arr.length; i++) {
				document.getElementById("mess").innerHTML ="---" + arr[i].length;
				inString +="<div class='d"+i+"'>"
					for (var j = 0; j < arr[i].length; j++) {	
							inString += "<span class='c"+arr[i][j]+"' id='d"+i+j+"'>"+i+j+"</span>";				
					}
				inString += "</div>"		
			}
			document.getElementById(div).innerHTML = inString;
			//alert(inString)
		},
		search:function(l,v){
			var nowNum = popStar.arr1[l][v];//选中的数组值
			for (var i = 0; i < this.arrVlineNum; i++) {//存放arr1每列数组的长度
				if(this.arr3.length==this.arrVlineNum){
					if(popStar.arr1[i]){
						popStar.arr3.splice(i,1,popStar.arr1[i].length)
					}else{
						popStar.arr3.push(0)
					}
				}else{
					if(popStar.arr1[i]){
						popStar.arr3.push(popStar.arr1[i].length)
					}else{
						popStar.arr3.push(0)
					}
				}
			}
			function find(l,v){
				//alert(popStar.arr2)
				// alert(l+"---"+v+"")

				if(v+1<popStar.arr1[l].length&& popStar.arr1[l][v+1]==nowNum){//向下
					if(popStar.arr2.length>0){
						for (var i = 0; i <popStar.arr2.length; i++) {//去重
							if (popStar.arr2[i]==l+","+(v+1)) {
								break;
							} else if (i==popStar.arr2.length-1) {
								popStar.arr2.push([l,v+1]);
								//popStar.spanNum[Number(l+""+(v+1))].className = popStar.spanNum[Number(l+""+(v+1))].className+" hover";
							}
						};
					}else{
						popStar.arr2.push([l,v+1]);
						//popStar.spanNum[Number(l+""+(v+1))].className = popStar.spanNum[Number(l+""+(v+1))].className+" hover";
					}
				} 
				if (popStar.arr1[l+1]&& popStar.arr1[l+1][v]==nowNum) {//向右
					if(popStar.arr2.length>0){
						for (var i = 0; i <popStar.arr2.length; i++) {
							if (popStar.arr2[i]==(l+1)+","+v) {
								break;
							} else if (i==popStar.arr2.length-1) {
								popStar.arr2.push([l+1,v]);
								//popStar.spanNum[Number((l+1)+""+v)].className = popStar.spanNum[Number((l+1)+""+v)].className+" hover";
							}
						};
					}else{
						popStar.arr2.push([l+1,v]);
						//popStar.spanNum[Number((l+1)+""+v)].className = popStar.spanNum[Number((l+1)+""+v)].className+" hover";
					}
				}
				if (v-1>=0 && popStar.arr1[l][v-1]==nowNum ) {//向上
					if(popStar.arr2.length>0){
						for (var i = 0; i <popStar.arr2.length; i++) {
							if (popStar.arr2[i]==l+","+(v-1)) {
								break;
							} else if (i==popStar.arr2.length-1) {
								popStar.arr2.push([l,v-1]);
								//popStar.spanNum[Number(l+""+(v-1))].className = popStar.spanNum[Number(l+""+(v-1))].className+" hover";
							}
						};
					}else{
						popStar.arr2.push([l,v-1]);
						//popStar.spanNum[Number(l+""+(v-1))].className = popStar.spanNum[Number(l+""+(v-1))].className+" hover";
					}
				}
				if (l-1>=0 && popStar.arr1[l-1][v]==nowNum ){//向左
					if(popStar.arr2.length>0){
						for (var i = 0; i <popStar.arr2.length; i++) {
							if (popStar.arr2[i]==(l-1)+","+v) {
								break;
							} else if (i==popStar.arr2.length-1) {
								popStar.arr2.push([l-1,v]);
								//popStar.spanNum[Number((l-1)+""+v)].className = popStar.spanNum[Number((l-1)+""+v)].className+" hover";
							}
						};
					}else{
						popStar.arr2.push([l-1,v]);
						//popStar.spanNum[Number((l-1)+""+v)].className = popStar.spanNum[Number((l-1)+""+v)].className+" hover";
					}
				}
				if(popStar.arr2.length == numSign+1&& numSign!=0){//hover
					popStar.clickStyle();
				};
			};
			var numSign = 0;//arr2数组标记位 每找一次加一
			if(popStar.arr2.length==0){
			find(l,v);}//第一次查找
			for (var i = 0; i < popStar.arr2.length; i++) {//二次点击如果在选中元素上
				if(popStar.arr2[i]==(l)+","+v){
					popStar.clearArr();
					break;
				}
			};
			if (popStar.arr2.length>0) {//如果有相邻数据 开始遍历
				for (var i = numSign; i < popStar.arr2.length; i++) {
					find(Number(popStar.arr2[i].toString().substr(0,1)),Number(popStar.arr2[i].toString().substr(2,1)));
					numSign++;
				};
			};
			

		},
		clickStyle:function(){
			popStar.arr2.sort();
			for (var i = 0; i < popStar.arr2.length; i++) {
				document.getElementById("d"+popStar.arr2[i].toString().substr(0,1)+popStar.arr2[i].toString().substr(2,1)).className += " hover"
				
			};
		},
		clearArr:function(){//清除数组
			popStar.arr2.sort();//重新排序 规律删除
			//alert(popStar.arr3)
			for (var i = 0; i < popStar.arr2.length; i++) {
					var k = Number(popStar.arr2[i].toString().substr(0,1));

					if(this.arr1[k].length!=popStar.arr3[k]){
						popStar.arr1[k].splice(Number(popStar.arr2[i].toString().substr(2,1))-(popStar.arr3[k]-popStar.arr1[k].length),1);
					}else{
						//alert("dengyu")
						popStar.arr1[k].splice(Number(popStar.arr2[i].toString().substr(2,1)),1);
					}
				}
				popStar.arr2.length=0;
				this.draw(this.arr1,"pop");//重新绘制界面
				this.bindEventClick();//重新绑定时间
		},
		bindEventClick:function(){//绑定事件
			this.spanNum = document.getElementById("pop").getElementsByTagName("span");
			for (var i = 0; i < this.spanNum.length; i++) {
				this.spanNum[i].onclick = (function(){ var k=i; return function(){popStar.clickEvent(k);}})();
			};
		},
		clickEvent:function(lv){//事件触发
			var l = Number(this.spanNum[lv].innerHTML.substr(0,1));
			var v = Number(this.spanNum[lv].innerHTML.substr(1,1));
			this.search(l,v);
		}
	}
	//popStar.init();
	popStar.init();
	</script>
	
</body>
</html>